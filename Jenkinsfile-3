pipeline {
  agent { label 'linux' }
  environment {
   ANSIBLE_PRIVATE_KEY=credentials('carvajaldev-private-key') 
  }
  stages {
    stage('Hello') {
      steps {
        //sh 'ansible-galaxy collection install -r requirements.yml'
        sh 'ls -la && pwd'
        def basedir = new File('.').canonicalPath
        def playbookPath = basedir + '/playbooks/message.yml'
        //sh 'ansible-playbook message.yml --user ubuntu --private-key=$ANSIBLE_PRIVATE_KEY -e "key=/home/ubuntu/.ssh/id_rsa.pub"'
        sh 'ansible-playbook ${playbookPath} --user ubuntu --private-key=$ANSIBLE_PRIVATE_KEY -e "key=/home/ubuntu/.ssh/id_rsa.pub"'
      }
    }
  }
}
